## Purpose
This directory contains the unit test suite for the `VoxCore` framework. It validates core logic for Speech-to-Text (STT) transcription, text rewriting strategies, and error handling. The tests focus on ensuring the reliability of provider orchestration, including retry logic, fallback mechanisms, health-aware routing, and concurrency management.

## Key Roles
- **STT Provider Decorator Tests**: Validates orchestration logic for transcription via `RetryingSTTProvider`, `FallbackSTTProvider`, `HedgedSTTProvider`, `ConcurrencyLimitedSTTProvider`, `TimeoutSTTProvider`, and `HealthAwareSTTProvider`.
- **Rewrite Provider Tests**: Verifies text transformation routing and fallback behavior in `FallbackRewriteProvider` and `ModelRoutedRewriteProvider`.
- **RewriteQualityGateTests**: Evaluates rewritten text quality using character ratios, Levenshtein similarity, and content word overlap to identify acceptable outputs or hallucinations.
- **Data Structure and Identity Tests**: Ensures consistency in `ProcessingLevel` definitions, legacy value migration, and `BrandIdentity` visual constants.
- **Error and Event Tests**: Validates error categorization in `STTError` and `VoxError`, and clamps values within `DictationUsageEvent`.
- **Infrastructure Tests**: Tests utility components like `MultipartFormData` for request building and `SecureFileDeleter` for file system cleanup.

## Dependencies and Caveats
- Utilizes both `XCTest` and the Swift `Testing` framework for test implementation.
- Relies on `@testable import VoxCore` to validate internal framework logic.
- Transcription tests simulate file system interactions using local `URL` paths for audio files.
- Concurrency-related tests use `NSLock` and `CheckedContinuation` to manage asynchronous state in test doubles.
- `TimeoutSTTProvider` uses a dynamic calculation based on `baseTimeout` and `secondsPerMB` to determine execution limits.
- `RewriteQualityGate` logic varies its acceptance thresholds (minimum and maximum ratios) based on the specific `ProcessingLevel` (raw, clean, or polish).
- Error handling logic distinguishes between retryable, fallback-eligible, and transient errors for health scoring.
- `ProcessingLevel` includes hardcoded migration mapping for legacy string values such as "off", "light", and "enhance".