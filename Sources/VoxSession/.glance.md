## Purpose
The `VoxSession` directory manages the lifecycle and orchestration of voice dictation sessions. It coordinates audio recording, microphone permissions, and the transition between idle, recording, and processing states. The directory handles the integration of speech-to-text (STT) and text-rewriting pipelines, supporting both real-time streaming and batch processing workflows.

## Key Roles
- `VoxSession.swift`: Serves as the primary controller for dictation sessions, managing state transitions and coordinating between audio capture, the processing pipeline, and the user interface. It implements streaming audio bridges, handles error presentation, manages dictation recovery via a dedicated store, and records diagnostic events.

## Dependencies and Caveats
- Depends on `VoxCore`, `VoxDiagnostics`, `VoxMac`, `VoxPipeline`, `VoxProviders`, and `VoxUI` for core logic, diagnostics, and interface components.
- Utilizes environment variables such as `VOX_STT_ROUTING`, `VOX_DISABLE_STREAMING_STT`, `VOX_AUDIO_BACKEND`, and `VOX_MAX_CONCURRENT_STT` to configure routing and concurrency.
- Requires microphone access granted via `PermissionManager` or a provided authorization closure.
- Implements a fallback mechanism for STT, prioritizing cloud providers with a final safety net using `AppleSpeechClient` or `SpeechTranscriberClient`.
- Supports streaming STT through ElevenLabs or Deepgram, with internal logic to transition to batch processing if streaming setup or finalization fails.
- Manages encrypted audio recordings, requiring `AudioFileEncryption` for decryption and secure handling of keys.
- Uses `LastDictationRecoveryStore` to persist raw and processed transcripts, enabling retries and recovery of recent sessions.
- Employs a `StreamingAudioBridge` and `StreamingSessionPump` to manage asynchronous audio chunk delivery and finalization timeouts during streaming.