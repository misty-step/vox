## Purpose
This directory provides the orchestration logic for a dictation pipeline that converts audio files or raw transcripts into formatted text. It integrates speech-to-text services with text-refining models and provides mechanisms for performance tracking, result caching, and transcript recovery. The pipeline manages the end-to-end lifecycle from initial audio validation to the final insertion of processed text.

## Key Roles
- `DictationPipeline.swift`: The central coordinator that executes the sequence of audio validation, optional Opus encoding, STT provider calls, text rewriting, and pasting.
- `RewritePrompts.swift`: Generates specialized system prompts for different processing levels to guide text refinement while preventing the model from fulfilling instructions contained within the transcript.
- `RewriteResultCache.swift`: An actor-based cache that stores previous rewrite results to minimize redundant provider calls based on transcript content, processing level, and model.
- `LastDictationRecoveryStore.swift`: An actor that maintains a temporary, time-limited snapshot of the most recent dictation to enable transcript recovery.
- `PipelineTiming`: A utility struct that tracks and summarizes duration and data size metrics for each stage of the pipeline.

## Dependencies and Caveats
- Depends on `VoxCore` for core protocols (`STTProvider`, `RewriteProvider`, `TextPaster`) and shared types like `ProcessingLevel` and `VoxError`.
- Opus conversion is conditionally applied to CAF files that exceed a specific byte threshold, with a fallback to the original file on failure or unavailability.
- The pipeline utilizes a fallback mechanism that returns the raw transcript if the rewrite stage fails, times out, or produces empty output.
- Execution is governed by configurable timeouts for the overall pipeline and individual rewrite stages.
- `RewriteResultCache` and `LastDictationRecoveryStore` enforce Time-To-Live (TTL) expiration policies.
- The rewrite cache is constrained by maximum entry counts and character limits for both input transcripts and output values.
- Relies on `FileManager` for file attribute inspection and a `SecureFileDeleter` for removing temporary encoded audio files.
- Thread safety for stateful components like the cache and recovery store is managed via Swift actors.