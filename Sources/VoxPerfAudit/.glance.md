## Purpose
This directory contains the entry point and core logic for a performance auditing tool designed to benchmark the dictation pipeline. It executes multiple iterations of the pipeline across different processing levels to measure latency distributions and record provider usage. The tool aggregates these metrics into a structured JSON report for performance analysis.

## Key Roles
- **main.swift**: Serves as the executable entry point, defining the `VoxPerfAudit` structure and orchestrating the benchmark lifecycle, including environment setup, pipeline execution, and result serialization.
- **ProviderUsageRecorder**: Manages thread-safe recording and snapshotting of STT and rewrite provider invocations to track model usage during audits.
- **TimingCollector**: Collects and stores `PipelineTiming` samples for various stages of the dictation process using locked access to ensure data integrity.
- **PerfPreferences**: Implements the `PreferencesReading` protocol to provide the pipeline with API keys and processing levels sourced from the environment.
- **NoopPaster**: Provides a non-functional implementation of the `TextPaster` protocol to prevent UI side effects during performance testing.
- **Instrumented Providers**: Wrappers for STT and rewrite providers that intercept calls to record usage metrics via the `ProviderUsageRecorder`.

## Dependencies and Caveats
- Depends on internal frameworks including `VoxPerfAuditKit`, `VoxAppKit`, `VoxCore`, `VoxPipeline`, and `VoxProviders`.
- Requires environment variables or a `.env.local` file for API keys (ElevenLabs, OpenRouter, Deepgram, Gemini).
- Utilizes `NSLock` to handle concurrent metric collection from the pipeline's timing handlers.
- Supports two operational lanes: a provider lane for real service benchmarking and a codepath lane using deterministic `FixedDelay` providers.
- The pipeline execution is configured with a hardcoded timeout of 180 seconds.
- Audit results are serialized to JSON following a specific schema (version 3) that includes statistical distributions for encoding, STT, and rewriting stages.
- Merges environment configurations to prioritize existing process variables over those found in local `.env` files.
- Uses `MainActor` for pipeline initialization and preference management.