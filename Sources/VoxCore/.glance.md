## Purpose
The `VoxCore` directory provides the foundational abstractions and infrastructure for a dictation and text processing pipeline. It defines core protocols for audio recording, speech-to-text (STT) transcription, and text rewriting, alongside decorators that implement error handling, concurrency control, and performance optimizations. The directory also manages shared domain logic for processing levels, UI branding constants, and quality evaluation of rewritten text.

## Key Roles
- **Protocols.swift**: Establishes the primary interfaces for STT providers, streaming sessions, rewrite engines, audio recorders, and UI displays.
- **STT Provider Decorators**: Implements robust transcription logic through concurrency limiting (`ConcurrencyLimitedSTTProvider`), retries (`RetryingSTTProvider`), timeouts (`TimeoutSTTProvider`), and health-based routing (`HealthAwareSTTProvider`).
- **Rewrite Provider Decorators**: Manages text transformation via sequential fallback (`FallbackRewriteProvider`) and model-based routing between Gemini and OpenRouter (`ModelRoutedRewriteProvider`).
- **RewriteQualityGate.swift**: Validates rewritten text by calculating Levenshtein similarity and content word overlap against configurable thresholds.
- **Errors.swift**: Centralizes error definitions and metadata for transcription, streaming, rewriting, and audio conversion.
- **ProcessingLevel.swift**: Defines the `raw`, `clean`, and `polish` levels used to determine processing behavior and default model selections.
- **MultipartFormData.swift**: Provides utilities for constructing multipart/form-data payloads, including a file-based builder for streaming audio data from disk.

## Dependencies and Caveats
- Relies on `Foundation` for file management, networking utilities, and concurrency primitives like `NSLock`.
- `HealthAwareSTTProvider` ranks providers based on success rates and average latency tracked within a sliding window.
- `ModelRoutedRewriteProvider` uses model ID prefixes (e.g., `gemini-` or `google/`) to determine the appropriate API route.
- `RewriteQualityGate` uses a hardcoded list of stop words to filter tokens during content overlap evaluation.
- `SecureFileDeleter` notes that secure overwriting is ineffective on APFS due to copy-on-write semantics.
- `ConcurrencyLimitedSTTProvider` utilizes a shared `AsyncSemaphorePool` to manage global limits across provider instances.
- `HedgedSTTProvider` executes multiple transcription attempts in a staggered race, returning the first successful result.
- `TimeoutSTTProvider` supports dynamic timeouts that scale based on the megabyte size of the audio file.